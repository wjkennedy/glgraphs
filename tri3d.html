<head>
  <style> body { margin: 0; } </style>

  <script src="http://cdn.jsdelivr.net/npm/3d-force-graph"></script>
  <script src="graph.js"></script>
</head>

<body>
  <div id="3d-graph"></div>

<script type="module">
  import { UnrealBloomPass } from 'https://esm.sh/three/examples/jsm/postprocessing/UnrealBloomPass.js';
  const elem = document.getElementById("3d-graph");

    const tri = new GrowingGraph(0b0000_1100_1011_1100);
    //0b0000_1100_1011_1100
    //0b0101_0110_1100_1100
    const {nodes} = tri, links = [];
    function updateLinks() {
        nodes.forEach((node,i)=>{node.id = i;});
        for (let source=0, i=0; source<nodes.length; ++source) {
            for (const target of nodes[source]) {
                if (source > target) continue;
                links[i] = links[i] || {};
                links[i].source = nodes[source];
                links[i].target = nodes[target];
                ++i
            }
        }
    }     
    updateLinks();   
    const Graph = new ForceGraph3D(elem)
        .backgroundColor('#000003')
        .enableNodeDrag(true)
        .linkOpacity(0.5)
        .numDimensions(3)
        .d3VelocityDecay(0.1)
        //.zoomToFit(1000,1000)
        .nodeColor(node=>tri.states[node.id] ? '#6bfb6b' : '#ff6b6b')
        .graphData({nodes, links});

    Graph.d3Force('link').distance(10).iterations(3).strength(1);
    Graph.d3Force('charge').strength(-80).distanceMax(1000);
    Graph.d3Force('center').strength(0.05);

    const bloomPass = new UnrealBloomPass();
    bloomPass.strength = 2;
    bloomPass.radius = 1;
    bloomPass.threshold = 0.0;
    Graph.postProcessingComposer().addPass(bloomPass);



    setInterval(() => {
        if (tri.nodes.length > 3000) return;
        tri.grow();
        updateLinks();
        Graph.graphData({nodes, links});
    }, 50);

  </script>
</body>